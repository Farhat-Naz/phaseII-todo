# Implementation Tasks: Agentic Todo Full-Stack Web Application

**Feature**: 001-todo-full-stack-app | **Branch**: 001-todo-full-stack-app | **Date**: 2026-01-07
**Plan**: [plan.md](./plan.md) | **Spec**: [spec.md](./spec.md)

**Note**: This file is generated by `/sp.tasks` command. Tasks are organized by User Story for independent story implementation, with exact file paths and dependency tracking.

---

## Task Organization Strategy

Tasks are organized by **User Story** (US1-US7) to enable independent, parallel implementation by specialized agents. Each user story section contains:

1. **Database Tasks**: Schema, migrations, models
2. **Backend Tasks**: API endpoints, validation, security
3. **Frontend Tasks**: UI components, API integration, state management
4. **Testing Tasks**: Unit tests, integration tests, E2E tests

**Dependency Notation**:
- `[P]` = Can run in parallel with other [P] tasks in the same section
- `Depends on: TASK-XXX` = Must complete after specified task
- `Agent: <name>` = Recommended specialized agent for the task

---

## US1: User Registration and Authentication (Priority: P1)

### Database Tasks (US1)

#### TASK-001: Create User Database Model [P]
**Agent**: `database-architect`
**File**: `backend/app/models.py`
**Description**: Define SQLModel User entity with UUID primary key, email (unique), hashed_password, name, timestamps
**Acceptance**:
- [ ] User model created with id (UUID), email (unique, indexed), hashed_password (NOT NULL), name, created_at, updated_at
- [ ] SQLModel table=True configuration
- [ ] Indexes: email (unique), created_at
- [ ] Type hints for all fields
**References**: `specs/001-todo-full-stack-app/data-model.md` (User entity definition)

#### TASK-002: Create Alembic Migration for Users Table
**Agent**: `database-architect`
**File**: `backend/alembic/versions/001_create_users.py`
**Depends on**: TASK-001
**Description**: Generate Alembic migration script to create users table with all constraints
**Acceptance**:
- [ ] Migration creates users table with UUID id (PK), email (VARCHAR unique), hashed_password (VARCHAR NOT NULL), name (VARCHAR), timestamps
- [ ] Unique constraint on email
- [ ] Indexes created for email, created_at
- [ ] upgrade() and downgrade() functions implemented
- [ ] Migration runs successfully: `uv run alembic upgrade head`

### Backend Tasks (US1)

#### TASK-003: Setup FastAPI Application Entry Point [P]
**Agent**: `backend-api-guardian`
**File**: `backend/app/main.py`
**Description**: Create FastAPI app with CORS, routers, exception handlers
**Acceptance**:
- [ ] FastAPI() instance created with title, version metadata
- [ ] CORS middleware configured with CORS_ORIGINS from env
- [ ] Health check endpoint: GET /health returns {"status": "ok"}
- [ ] Exception handlers for HTTPException, RequestValidationError
- [ ] App runs: `uv run uvicorn app.main:app --reload --port 8000`

#### TASK-004: Setup Neon PostgreSQL Database Connection [P]
**Agent**: `database-architect`
**File**: `backend/app/database.py`
**Description**: Configure SQLModel engine and session with Neon connection pooling
**Acceptance**:
- [ ] create_engine() configured with DATABASE_URL from env
- [ ] Connection pooling: pool_size=5, max_overflow=10, pool_pre_ping=True
- [ ] Session dependency for dependency injection
- [ ] SSL mode required for Neon connection
- [ ] Connection test successful

#### TASK-005: Create Pydantic Schemas for Auth [P]
**Agent**: `backend-api-guardian`
**File**: `backend/app/schemas.py`
**Description**: Define request/response schemas for registration, login, token, user
**Acceptance**:
- [ ] UserRegister: email (EmailStr), password (min 8 chars), name
- [ ] UserLogin: email (EmailStr), password
- [ ] Token: access_token (str), token_type (str), user (UserPublic)
- [ ] UserPublic: id, email, name (excludes password)
- [ ] Field validators: password complexity (1 upper, 1 lower, 1 number)

#### TASK-006: Implement Password Hashing Utility
**Agent**: `auth-config-specialist`
**File**: `backend/app/auth.py` (functions: hash_password, verify_password)
**Description**: Create bcrypt-based password hashing and verification
**Acceptance**:
- [ ] hash_password(plain_password: str) -> str using bcrypt
- [ ] verify_password(plain_password: str, hashed_password: str) -> bool
- [ ] Salt rounds >= 12 for security
- [ ] Type hints on all functions
- [ ] Unit tests pass for hash/verify

#### TASK-007: Implement JWT Token Generation and Validation
**Agent**: `auth-config-specialist`
**File**: `backend/app/auth.py` (functions: create_access_token, decode_access_token)
**Description**: Create JWT token issuance and validation with python-jose
**Acceptance**:
- [ ] create_access_token(user_id: UUID) -> str
- [ ] decode_access_token(token: str) -> dict with "sub" claim
- [ ] BETTER_AUTH_SECRET from env used for signing
- [ ] Access token expiry: 30 minutes (from env)
- [ ] Refresh token expiry: 7 days (from env)
- [ ] HS256 algorithm
- [ ] Handle TokenExpiredError, JWTError exceptions

#### TASK-008: Create FastAPI Dependency for Current User
**Agent**: `backend-api-guardian`
**File**: `backend/app/dependencies.py` (get_current_user dependency)
**Description**: Extract user_id from JWT and fetch user from database
**Acceptance**:
- [ ] Dependency: get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(get_db))
- [ ] Extract user_id from JWT "sub" claim
- [ ] Query database for user by ID
- [ ] Raise HTTPException 401 if token invalid or user not found
- [ ] Return User model instance
- [ ] Type hint: -> User

#### TASK-009: Create Auth Router - Registration Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/auth.py` (POST /api/auth/register)
**Depends on**: TASK-005, TASK-006, TASK-007
**Description**: Implement user registration with email uniqueness check
**Acceptance**:
- [ ] POST /api/auth/register
- [ ] Request body: UserRegister schema
- [ ] Check email uniqueness, return 400 if exists
- [ ] Hash password with hash_password()
- [ ] Create user record in database
- [ ] Generate JWT with create_access_token()
- [ ] Response 201: Token schema with access_token and user data
- [ ] Response 400: {error: "Email already registered"}

#### TASK-010: Create Auth Router - Login Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/auth.py` (POST /api/auth/login)
**Depends on**: TASK-005, TASK-006, TASK-007
**Description**: Authenticate user and issue JWT token
**Acceptance**:
- [ ] POST /api/auth/login
- [ ] Request body: UserLogin schema
- [ ] Query user by email
- [ ] Verify password with verify_password()
- [ ] Return 401 if email not found or password invalid: {error: "Invalid credentials"}
- [ ] Generate JWT with create_access_token()
- [ ] Response 200: Token schema
- [ ] Never reveal whether email or password is wrong (prevent enumeration)

#### TASK-011: Create Auth Router - Get Current User Endpoint [P]
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/auth.py` (GET /api/auth/me)
**Depends on**: TASK-008
**Description**: Return authenticated user's profile
**Acceptance**:
- [ ] GET /api/auth/me
- [ ] Protected: Depends(get_current_user)
- [ ] Response 200: UserPublic schema with current user data
- [ ] Response 401 if token invalid or expired

### Frontend Tasks (US1)

#### TASK-012: Setup Next.js 16 Project with App Router [P]
**Agent**: `frontend-builder`
**Files**: `frontend/app/layout.tsx`, `frontend/next.config.js`, `frontend/tailwind.config.ts`
**Description**: Initialize Next.js with TypeScript, Tailwind CSS, App Router structure
**Acceptance**:
- [ ] Next.js 16+ installed via pnpm
- [ ] TypeScript strict mode enabled
- [ ] Tailwind CSS 3.4+ configured
- [ ] Root layout.tsx with HTML lang="en"
- [ ] Metadata configured (title, description)
- [ ] App runs: `pnpm dev` on http://localhost:3000

#### TASK-013: Configure Better Auth Client
**Agent**: `auth-config-specialist`
**File**: `frontend/lib/auth.ts`
**Description**: Setup Better Auth client configuration for JWT handling
**Acceptance**:
- [ ] Better Auth client initialized with NEXT_PUBLIC_API_URL
- [ ] BETTER_AUTH_SECRET configured from env
- [ ] Token storage in httpOnly cookies
- [ ] Auto token refresh configured
- [ ] Export auth client instance

#### TASK-014: Create API Client with JWT Interceptor
**Agent**: `frontend-builder`
**File**: `frontend/lib/api.ts`
**Description**: Create axios/fetch wrapper that attaches JWT to requests
**Acceptance**:
- [ ] API client configured with base URL from env
- [ ] Request interceptor attaches Authorization: Bearer {token}
- [ ] Response interceptor handles 401 (redirect to login)
- [ ] Type-safe methods: get(), post(), put(), patch(), delete()
- [ ] Error handling with clear error messages

#### TASK-015: Create TypeScript Types for User and Auth
**Agent**: `frontend-builder`
**File**: `frontend/types/user.ts`
**Description**: Define TypeScript interfaces matching backend schemas
**Acceptance**:
- [ ] User interface: id, email, name, created_at, updated_at
- [ ] UserRegister interface: email, password, name
- [ ] UserLogin interface: email, password
- [ ] Token interface: access_token, token_type, user
- [ ] No 'any' types, strict TypeScript compliance

#### TASK-016: Create useAuth Hook for Authentication State
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useAuth.ts`
**Description**: Custom React hook managing auth state and operations
**Acceptance**:
- [ ] State: user (User | null), loading (boolean), error (string | null)
- [ ] Methods: register(data), login(data), logout(), refreshToken()
- [ ] Auto-fetch current user on mount if token exists
- [ ] Store token in cookies via Better Auth
- [ ] Type-safe return value

#### TASK-017: Create Registration Form Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/auth/RegisterForm.tsx`
**Description**: Client component for user registration with validation
**Acceptance**:
- [ ] Form fields: email (EmailInput), password (PasswordInput), name (TextInput)
- [ ] Client-side validation: email format, password min 8 chars
- [ ] Submit calls useAuth().register()
- [ ] Loading state during submission
- [ ] Error display for validation or server errors
- [ ] Success: redirect to dashboard
- [ ] Link to login page for existing users

#### TASK-018: Create Login Form Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/auth/LoginForm.tsx`
**Description**: Client component for user login
**Acceptance**:
- [ ] Form fields: email, password
- [ ] Submit calls useAuth().login()
- [ ] Loading state during submission
- [ ] Error display: "Invalid credentials" message
- [ ] Success: redirect to dashboard
- [ ] Link to registration page for new users

#### TASK-019: Create Registration Page
**Agent**: `frontend-builder`
**File**: `frontend/app/(auth)/register/page.tsx`
**Description**: Server component wrapping RegisterForm
**Acceptance**:
- [ ] Server Component with metadata
- [ ] Renders RegisterForm component
- [ ] Tailwind styling: centered card, mobile-responsive
- [ ] Page title: "Create Account"
- [ ] Redirect to dashboard if already authenticated

#### TASK-020: Create Login Page
**Agent**: `frontend-builder`
**File**: `frontend/app/(auth)/login/page.tsx`
**Description**: Server component wrapping LoginForm
**Acceptance**:
- [ ] Server Component with metadata
- [ ] Renders LoginForm component
- [ ] Tailwind styling: centered card, mobile-responsive
- [ ] Page title: "Sign In"
- [ ] Redirect to dashboard if already authenticated

### Testing Tasks (US1)

#### TASK-021: Backend Tests - Auth Endpoints [P]
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_auth.py`
**Depends on**: TASK-009, TASK-010, TASK-011
**Description**: pytest tests for registration, login, /me endpoints
**Acceptance**:
- [ ] Test registration with valid data returns 201 and JWT
- [ ] Test registration with duplicate email returns 400
- [ ] Test registration with weak password returns 422
- [ ] Test login with valid credentials returns 200 and JWT
- [ ] Test login with invalid credentials returns 401
- [ ] Test GET /me with valid token returns 200 and user data
- [ ] Test GET /me with expired token returns 401
- [ ] All tests pass: `uv run pytest -v tests/test_auth.py`

#### TASK-022: Frontend Tests - Auth Components [P]
**Agent**: `frontend-builder`
**File**: `frontend/tests/components/RegisterForm.test.tsx`
**Depends on**: TASK-017, TASK-018
**Description**: Jest + React Testing Library tests for auth forms
**Acceptance**:
- [ ] Test RegisterForm renders all fields
- [ ] Test RegisterForm validates email format
- [ ] Test RegisterForm validates password length
- [ ] Test RegisterForm calls register() on submit
- [ ] Test LoginForm renders all fields
- [ ] Test LoginForm calls login() on submit
- [ ] Test LoginForm displays error on invalid credentials
- [ ] All tests pass: `pnpm test`

#### TASK-023: E2E Tests - Registration and Login Flow [P]
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/auth.spec.ts`
**Depends on**: TASK-019, TASK-020
**Description**: Playwright E2E tests for full auth flow
**Acceptance**:
- [ ] Test: Visit /register, fill form, submit, verify redirect to dashboard
- [ ] Test: Visit /login with wrong credentials, see error
- [ ] Test: Visit /login with correct credentials, verify redirect to dashboard
- [ ] Test: Access protected page without login, verify redirect to /login
- [ ] Test: Token expiry triggers re-login
- [ ] All tests pass: `pnpm test:e2e`

---

## US2: Create and View Personal Todos (Priority: P1)

### Database Tasks (US2)

#### TASK-024: Create Todo Database Model
**Agent**: `database-architect`
**File**: `backend/app/models.py`
**Description**: Define SQLModel Todo entity with user_id foreign key
**Acceptance**:
- [ ] Todo model: id (UUID PK), user_id (UUID FK to users.id), title (VARCHAR NOT NULL), description (TEXT nullable), completed (BOOLEAN default false), created_at, updated_at
- [ ] SQLModel table=True, relationship to User
- [ ] Foreign key constraint: user_id REFERENCES users(id) ON DELETE CASCADE
- [ ] Indexes: user_id, completed, created_at
- [ ] Type hints for all fields
**References**: `specs/001-todo-full-stack-app/data-model.md` (Todo entity definition)

#### TASK-025: Create Alembic Migration for Todos Table
**Agent**: `database-architect`
**File**: `backend/alembic/versions/002_create_todos.py`
**Depends on**: TASK-024, TASK-002
**Description**: Generate migration for todos table with foreign key to users
**Acceptance**:
- [ ] Migration creates todos table with all fields
- [ ] Foreign key constraint on user_id
- [ ] Indexes: user_id, completed, created_at
- [ ] CASCADE delete (when user deleted, todos deleted)
- [ ] Migration runs: `uv run alembic upgrade head`

### Backend Tasks (US2)

#### TASK-026: Create Pydantic Schemas for Todos
**Agent**: `backend-api-guardian`
**File**: `backend/app/schemas.py`
**Description**: Define Todo request/response schemas
**Acceptance**:
- [ ] TodoCreate: title (str, min 1 max 500), description (optional str, max 2000), completed (optional bool, default false)
- [ ] TodoUpdate: title (optional), description (optional), completed (optional)
- [ ] TodoPublic: id, user_id, title, description, completed, created_at, updated_at
- [ ] Field validators: title required and not blank

#### TASK-027: Create Todo Router - Create Todo Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/todos.py` (POST /api/todos)
**Depends on**: TASK-008, TASK-026
**Description**: Create todo for authenticated user
**Acceptance**:
- [ ] POST /api/todos
- [ ] Protected: current_user = Depends(get_current_user)
- [ ] Request body: TodoCreate schema
- [ ] Extract user_id from current_user.id (NEVER from request body)
- [ ] Create todo with user_id set to current_user.id
- [ ] Response 201: TodoPublic schema
- [ ] Response 422 if title empty

#### TASK-028: Create Todo Router - List User Todos Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/todos.py` (GET /api/todos)
**Depends on**: TASK-008, TASK-026
**Description**: Retrieve all todos for authenticated user
**Acceptance**:
- [ ] GET /api/todos
- [ ] Protected: current_user = Depends(get_current_user)
- [ ] Query: filter by user_id = current_user.id
- [ ] Order by: created_at DESC (newest first)
- [ ] Response 200: List[TodoPublic]
- [ ] Empty array if no todos
- [ ] NEVER return todos from other users

### Frontend Tasks (US2)

#### TASK-029: Create TypeScript Types for Todo
**Agent**: `frontend-builder`
**File**: `frontend/types/todo.ts`
**Description**: Define Todo interfaces matching backend schemas
**Acceptance**:
- [ ] Todo interface: id, user_id, title, description, completed, created_at, updated_at
- [ ] TodoCreate interface: title, description?, completed?
- [ ] TodoUpdate interface: title?, description?, completed?
- [ ] No 'any' types

#### TASK-030: Create useTodos Hook for Todo CRUD
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useTodos.ts`
**Description**: React hook managing todos state and operations
**Acceptance**:
- [ ] State: todos (Todo[]), loading (boolean), error (string | null)
- [ ] Methods: fetchTodos(), createTodo(data), updateTodo(id, data), deleteTodo(id), toggleComplete(id)
- [ ] Auto-fetch todos on mount
- [ ] Optimistic UI updates for all mutations
- [ ] Error handling with rollback on failure
- [ ] Type-safe return value

#### TASK-031: Create TodoForm Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/TodoForm.tsx`
**Description**: Form for creating/editing todos
**Acceptance**:
- [ ] Client Component
- [ ] Form fields: title (required, max 500 chars), description (optional, textarea, max 2000 chars)
- [ ] Props: onSubmit(data: TodoCreate), initialData? (for edit mode), loading (boolean)
- [ ] Validation: title required, char limits enforced
- [ ] Submit calls onSubmit prop
- [ ] Clear form after successful creation
- [ ] Keyboard shortcut: Enter to submit (Shift+Enter for newline in description)

#### TASK-032: Create TodoItem Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/TodoItem.tsx`
**Description**: Display and interact with a single todo
**Acceptance**:
- [ ] Client Component
- [ ] Props: todo (Todo), onToggle(id), onEdit(id), onDelete(id)
- [ ] Display: checkbox, title, description, timestamps
- [ ] Checkbox click calls onToggle
- [ ] Edit button calls onEdit (opens inline edit or modal)
- [ ] Delete button calls onDelete (with confirmation)
- [ ] Completed todos: strikethrough title, faded appearance
- [ ] Accessible: keyboard navigation, ARIA labels
- [ ] Responsive: mobile-friendly touch targets (44x44px)

#### TASK-033: Create TodoList Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/TodoList.tsx`
**Description**: Container displaying all user todos
**Acceptance**:
- [ ] Client Component
- [ ] Uses useTodos() hook
- [ ] Renders TodoForm for creation
- [ ] Renders TodoItem for each todo
- [ ] Loading state: spinner
- [ ] Empty state: "No todos yet. Create your first task!"
- [ ] Error state: error message with retry button
- [ ] Separates completed/incomplete todos
- [ ] Reverse chronological order (newest first)

#### TASK-034: Create Dashboard Page
**Agent**: `frontend-builder`
**File**: `frontend/app/(dashboard)/page.tsx`
**Depends on**: TASK-033
**Description**: Main authenticated dashboard with todo list
**Acceptance**:
- [ ] Server Component with metadata
- [ ] Auth guard: redirect to /login if not authenticated
- [ ] Renders TodoList component
- [ ] Header with user name and logout button
- [ ] Page title: "My Todos"
- [ ] Responsive layout: mobile-first

#### TASK-035: Create Dashboard Layout
**Agent**: `frontend-builder`
**File**: `frontend/app/(dashboard)/layout.tsx`
**Description**: Shared layout for authenticated pages
**Acceptance**:
- [ ] Server Component
- [ ] Auth guard: redirect to /login if not authenticated
- [ ] Header component with navigation and logout
- [ ] Footer component
- [ ] Main content area with max-width constraint
- [ ] Tailwind styling: responsive, accessible

### Testing Tasks (US2)

#### TASK-036: Backend Tests - Todo CRUD Endpoints
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_todos.py`
**Depends on**: TASK-027, TASK-028
**Description**: pytest tests for todo creation and retrieval
**Acceptance**:
- [ ] Test POST /api/todos with valid data returns 201 and todo
- [ ] Test POST /api/todos without auth returns 401
- [ ] Test POST /api/todos without title returns 422
- [ ] Test GET /api/todos returns only current user's todos
- [ ] Test GET /api/todos without auth returns 401
- [ ] Test GET /api/todos returns empty array for new user
- [ ] Test todos ordered by created_at DESC
- [ ] All tests pass: `uv run pytest -v tests/test_todos.py`

#### TASK-037: Backend Tests - Multi-Tenant Data Isolation
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_security.py`
**Depends on**: TASK-027, TASK-028
**Description**: Security tests ensuring user data isolation
**Acceptance**:
- [ ] Create two users (user1, user2)
- [ ] user1 creates todo
- [ ] user2 queries todos, verifies user1's todo NOT returned
- [ ] Direct API call to access user1's todo with user2's token returns 404 (not 403)
- [ ] All tests pass: `uv run pytest -v tests/test_security.py`

#### TASK-038: Frontend Tests - Todo Components
**Agent**: `frontend-builder`
**File**: `frontend/tests/components/TodoList.test.tsx`
**Depends on**: TASK-031, TASK-032, TASK-033
**Description**: Jest tests for todo UI components
**Acceptance**:
- [ ] Test TodoForm renders all fields
- [ ] Test TodoForm validates title required
- [ ] Test TodoForm calls onSubmit with correct data
- [ ] Test TodoItem renders todo data
- [ ] Test TodoItem checkbox calls onToggle
- [ ] Test TodoItem edit button calls onEdit
- [ ] Test TodoList renders todos in reverse chronological order
- [ ] Test TodoList displays empty state
- [ ] All tests pass: `pnpm test`

#### TASK-039: E2E Tests - Todo Creation and Viewing
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/todo-crud.spec.ts`
**Depends on**: TASK-034
**Description**: Playwright E2E tests for todo creation and viewing
**Acceptance**:
- [ ] Test: Login, create todo, verify it appears in list
- [ ] Test: Create multiple todos, verify reverse chronological order
- [ ] Test: Refresh page, verify todos persist
- [ ] Test: Two users, verify user1 doesn't see user2's todos
- [ ] All tests pass: `pnpm test:e2e`

---

## US3: Mark Todos as Complete/Incomplete (Priority: P1)

### Backend Tasks (US3)

#### TASK-040: Create Todo Router - Toggle Completion Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/todos.py` (PATCH /api/todos/{id})
**Depends on**: TASK-008, TASK-026
**Description**: Update todo completion status with ownership verification
**Acceptance**:
- [ ] PATCH /api/todos/{id}
- [ ] Protected: current_user = Depends(get_current_user)
- [ ] Request body: TodoUpdate schema (partial update)
- [ ] Query todo by id AND user_id = current_user.id
- [ ] If not found, return 404 (prevents enumeration)
- [ ] Update only provided fields (completed, title, description)
- [ ] Update updated_at timestamp
- [ ] Response 200: TodoPublic schema
- [ ] Response 404 if todo doesn't exist or belongs to another user

### Frontend Tasks (US3)

#### TASK-041: Implement Toggle Completion in useTodos Hook
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useTodos.ts` (toggleComplete method)
**Depends on**: TASK-030
**Description**: Add optimistic toggle with rollback on error
**Acceptance**:
- [ ] toggleComplete(id: string) method
- [ ] Optimistic update: immediately flip completed status in local state
- [ ] API call: PATCH /api/todos/{id} with new completed value
- [ ] On error: rollback local state, show error message
- [ ] On success: state already reflects change (optimistic)
- [ ] Return Promise for async handling

#### TASK-042: Wire Toggle to TodoItem Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/TodoItem.tsx`
**Depends on**: TASK-032, TASK-041
**Description**: Connect checkbox to toggleComplete action
**Acceptance**:
- [ ] Checkbox onChange calls onToggle(todo.id)
- [ ] Visual feedback: strikethrough on completed, fade color
- [ ] Loading state during toggle (disable checkbox briefly)
- [ ] Accessible: ARIA label "Mark as complete" / "Mark as incomplete"
- [ ] Keyboard: Space/Enter toggle completion

### Testing Tasks (US3)

#### TASK-043: Backend Tests - Toggle Completion
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_todos.py`
**Depends on**: TASK-040
**Description**: Test completion toggle endpoint
**Acceptance**:
- [ ] Test PATCH /api/todos/{id} with completed=true updates status
- [ ] Test PATCH /api/todos/{id} with completed=false updates status
- [ ] Test PATCH with invalid todo id returns 404
- [ ] Test PATCH another user's todo returns 404
- [ ] Test updated_at timestamp changes
- [ ] All tests pass: `uv run pytest -v tests/test_todos.py`

#### TASK-044: E2E Tests - Toggle Completion Flow
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/todo-crud.spec.ts`
**Depends on**: TASK-042
**Description**: E2E test for marking complete/incomplete
**Acceptance**:
- [ ] Test: Create todo, click checkbox, verify strikethrough
- [ ] Test: Click checkbox again, verify strikethrough removed
- [ ] Test: Refresh page, verify completion status persists
- [ ] Test: Optimistic UI: checkbox responds immediately
- [ ] All tests pass: `pnpm test:e2e`

---

## US4: Update and Delete Todos (Priority: P2)

### Backend Tasks (US4)

#### TASK-045: Create Todo Router - Get Single Todo Endpoint [P]
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/todos.py` (GET /api/todos/{id})
**Depends on**: TASK-008
**Description**: Retrieve single todo by ID with ownership check
**Acceptance**:
- [ ] GET /api/todos/{id}
- [ ] Protected: current_user = Depends(get_current_user)
- [ ] Query todo by id AND user_id = current_user.id
- [ ] Response 200: TodoPublic schema
- [ ] Response 404 if not found or belongs to another user

#### TASK-046: Create Todo Router - Delete Todo Endpoint
**Agent**: `backend-api-guardian`
**File**: `backend/app/routers/todos.py` (DELETE /api/todos/{id})
**Depends on**: TASK-008
**Description**: Delete todo with ownership verification
**Acceptance**:
- [ ] DELETE /api/todos/{id}
- [ ] Protected: current_user = Depends(get_current_user)
- [ ] Query todo by id AND user_id = current_user.id
- [ ] If not found, return 404
- [ ] Delete todo from database
- [ ] Response 204 No Content
- [ ] Response 404 if todo doesn't exist or belongs to another user

### Frontend Tasks (US4)

#### TASK-047: Implement Update and Delete in useTodos Hook
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useTodos.ts` (updateTodo, deleteTodo methods)
**Depends on**: TASK-030
**Description**: Add update and delete methods with optimistic UI
**Acceptance**:
- [ ] updateTodo(id: string, data: TodoUpdate) method
- [ ] Optimistic update: immediately update todo in local state
- [ ] API call: PATCH /api/todos/{id}
- [ ] deleteTodo(id: string) method
- [ ] Optimistic delete: immediately remove from local state
- [ ] API call: DELETE /api/todos/{id}
- [ ] Rollback on error for both operations
- [ ] Confirmation dialog before delete

#### TASK-048: Add Edit Mode to TodoItem Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/TodoItem.tsx`
**Depends on**: TASK-032, TASK-047
**Description**: Inline editing for todo title and description
**Acceptance**:
- [ ] Edit button toggles edit mode
- [ ] In edit mode: show input fields for title and description
- [ ] Save button calls onEdit(id, newData)
- [ ] Cancel button reverts changes
- [ ] Escape key cancels edit, Enter key saves
- [ ] Delete button with confirmation dialog calls onDelete(id)
- [ ] Confirmation: "Delete this todo? This cannot be undone."
- [ ] Accessible: focus management, ARIA labels

### Testing Tasks (US4)

#### TASK-049: Backend Tests - Update and Delete Endpoints
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_todos.py`
**Depends on**: TASK-045, TASK-046
**Description**: Test update and delete endpoints
**Acceptance**:
- [ ] Test GET /api/todos/{id} returns correct todo
- [ ] Test GET /api/todos/{id} for another user's todo returns 404
- [ ] Test PATCH /api/todos/{id} updates title and description
- [ ] Test PATCH another user's todo returns 404
- [ ] Test DELETE /api/todos/{id} removes todo
- [ ] Test DELETE another user's todo returns 404
- [ ] Test DELETE non-existent todo returns 404
- [ ] All tests pass: `uv run pytest -v tests/test_todos.py`

#### TASK-050: E2E Tests - Update and Delete Flows
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/todo-crud.spec.ts`
**Depends on**: TASK-048
**Description**: E2E tests for editing and deleting todos
**Acceptance**:
- [ ] Test: Create todo, edit title, verify changes persist
- [ ] Test: Create todo, edit description, verify changes
- [ ] Test: Create todo, delete, verify removal
- [ ] Test: Delete confirmation dialog appears and works
- [ ] Test: Cancel delete, verify todo remains
- [ ] All tests pass: `pnpm test:e2e`

---

## US5: Voice Command Task Creation (Priority: P2)

### Frontend Tasks (US5)

#### TASK-051: Create Voice Recognition Service
**Agent**: `frontend-builder`
**File**: `frontend/lib/voice.ts`
**Description**: Wrapper for Web Speech API with English and Urdu support
**Acceptance**:
- [ ] startListening(lang: 'en-US' | 'ur-PK') method
- [ ] stopListening() method
- [ ] Event handlers: onResult(transcript), onError(error), onEnd()
- [ ] Browser compatibility check
- [ ] Graceful degradation if not supported
- [ ] Type-safe API

#### TASK-052: Create Voice Intent Parser
**Agent**: `frontend-builder`
**File**: `frontend/lib/voice.ts` (parseVoiceCommand function)
**Description**: Parse voice transcripts into todo actions
**Acceptance**:
- [ ] English patterns: "add todo: {title}", "new task: {title}", "create todo: {title}"
- [ ] Urdu patterns: "نیا کام: {title}", "ٹاسک بنائیں: {title}"
- [ ] Roman Urdu: "naya kaam: {title}"
- [ ] Return: { action: 'create' | 'complete' | 'unknown', title?: string }
- [ ] Handle unrecognized commands gracefully

#### TASK-053: Create useVoice Hook
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useVoice.ts`
**Description**: React hook managing voice recognition state
**Acceptance**:
- [ ] State: isListening (boolean), transcript (string), error (string | null)
- [ ] Methods: startVoice(lang), stopVoice()
- [ ] Auto-parse transcript with parseVoiceCommand()
- [ ] Call useTodos().createTodo() on recognized create command
- [ ] Handle errors and display user-friendly messages
- [ ] Browser support detection

#### TASK-054: Create VoiceInput Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/todos/VoiceInput.tsx`
**Description**: Voice command button with visual feedback
**Acceptance**:
- [ ] Client Component
- [ ] Microphone button (icon: mic or mic-off)
- [ ] Click toggles isListening
- [ ] Visual feedback: pulsing animation when listening
- [ ] Display transcript in real-time
- [ ] Language selector: English / Urdu
- [ ] Browser support: hide button if not supported
- [ ] Permission handling: prompt for microphone access
- [ ] Error messages: "Microphone access denied", "Not supported"
- [ ] Accessible: ARIA label "Start voice input" / "Stop voice input"

#### TASK-055: Integrate VoiceInput into Dashboard
**Agent**: `frontend-builder`
**File**: `frontend/app/(dashboard)/page.tsx`
**Depends on**: TASK-034, TASK-054
**Description**: Add voice input to dashboard UI
**Acceptance**:
- [ ] VoiceInput component rendered near TodoForm
- [ ] Voice-created todos appear immediately in list (optimistic UI)
- [ ] Clear visual indication: "Voice command: {transcript}"
- [ ] Mobile-responsive placement

### Testing Tasks (US5)

#### TASK-056: Frontend Tests - Voice Recognition
**Agent**: `frontend-builder`
**File**: `frontend/tests/lib/voice.test.ts`
**Depends on**: TASK-051, TASK-052
**Description**: Unit tests for voice parsing
**Acceptance**:
- [ ] Test parseVoiceCommand("add todo: buy milk") returns {action: 'create', title: 'buy milk'}
- [ ] Test parseVoiceCommand("نیا کام: دودھ خریدیں") returns {action: 'create', title: 'دودھ خریدیں'}
- [ ] Test parseVoiceCommand("hello world") returns {action: 'unknown'}
- [ ] Test English patterns: "new task:", "create todo:"
- [ ] Test Urdu patterns with Roman and script
- [ ] All tests pass: `pnpm test`

#### TASK-057: E2E Tests - Voice Todo Creation
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/voice.spec.ts`
**Depends on**: TASK-055
**Description**: E2E test simulating voice input (mocked)
**Acceptance**:
- [ ] Mock Web Speech API in Playwright
- [ ] Test: Click mic, trigger transcript "add todo: test task", verify todo created
- [ ] Test: Unsupported browser shows fallback message
- [ ] Test: Denied permissions show error message
- [ ] All tests pass: `pnpm test:e2e`

---

## US6: Voice Command Task Completion (Priority: P3)

### Frontend Tasks (US6)

#### TASK-058: Extend Voice Intent Parser for Completion
**Agent**: `frontend-builder`
**File**: `frontend/lib/voice.ts` (parseVoiceCommand updates)
**Depends on**: TASK-052
**Description**: Add completion command patterns
**Acceptance**:
- [ ] English patterns: "complete todo: {title}", "finish: {title}", "mark done: {title}"
- [ ] Urdu patterns: "مکمل کریں: {title}", "ختم کریں: {title}"
- [ ] Roman Urdu: "mukammal karen: {title}"
- [ ] Return: { action: 'complete', title: string }
- [ ] Match todo by title (fuzzy matching for close matches)

#### TASK-059: Implement Voice Completion in useVoice Hook
**Agent**: `frontend-builder`
**File**: `frontend/hooks/useVoice.ts`
**Depends on**: TASK-053, TASK-058
**Description**: Handle completion commands
**Acceptance**:
- [ ] On action: 'complete', find todo by title
- [ ] Call useTodos().toggleComplete(todo.id)
- [ ] Fuzzy match if exact title not found
- [ ] Confirmation: "Marked '{title}' as complete"
- [ ] Error if todo not found: "Todo '{title}' not found"

### Testing Tasks (US6)

#### TASK-060: Frontend Tests - Voice Completion
**Agent**: `frontend-builder`
**File**: `frontend/tests/lib/voice.test.ts`
**Depends on**: TASK-058
**Description**: Test voice completion parsing
**Acceptance**:
- [ ] Test parseVoiceCommand("complete todo: buy milk") returns {action: 'complete', title: 'buy milk'}
- [ ] Test parseVoiceCommand("مکمل کریں: دودھ خریدیں") returns {action: 'complete', title: 'دودھ خریدیں'}
- [ ] Test fuzzy matching for similar titles
- [ ] All tests pass: `pnpm test`

---

## US7: Multilingual UI (Urdu Support) (Priority: P3)

### Frontend Tasks (US7)

#### TASK-061: Setup i18n with next-intl
**Agent**: `frontend-builder`
**File**: `frontend/app/[locale]/layout.tsx`
**Description**: Configure internationalization for English and Urdu
**Acceptance**:
- [ ] Install next-intl
- [ ] Configure locales: en, ur
- [ ] Locale routing: /en/*, /ur/*
- [ ] Default locale: en
- [ ] Locale detection from browser settings

#### TASK-062: Create Translation Files
**Agent**: `urdu-translator`
**Files**: `frontend/public/locales/en.json`, `frontend/public/locales/ur.json`
**Description**: English and Urdu translations for all UI strings
**Acceptance**:
- [ ] en.json: All UI strings in English
- [ ] ur.json: All UI strings in Urdu script
- [ ] Keys: auth (login, register, logout), todos (title, description, create, edit, delete, complete), common (loading, error, success)
- [ ] Proper Urdu grammar and cultural appropriateness
- [ ] Consistent terminology

#### TASK-063: Create Language Switcher Component
**Agent**: `frontend-builder`
**File**: `frontend/components/features/shared/LanguageSwitcher.tsx`
**Description**: UI toggle for language selection
**Acceptance**:
- [ ] Client Component
- [ ] Toggle: English / اردو
- [ ] Changes locale via next-intl
- [ ] Persists preference in localStorage
- [ ] Icon or text button
- [ ] Accessible: ARIA label

#### TASK-064: Apply RTL Layout for Urdu
**Agent**: `frontend-builder`
**File**: `frontend/app/[locale]/layout.tsx` (RTL styling)
**Depends on**: TASK-061
**Description**: Right-to-left text direction for Urdu
**Acceptance**:
- [ ] HTML dir="rtl" when locale is 'ur'
- [ ] Tailwind RTL utilities applied
- [ ] All layouts mirror correctly (flexbox reverse, text-right)
- [ ] Icons and buttons flip appropriately
- [ ] Input fields align right

#### TASK-065: Translate All UI Components
**Agent**: `urdu-translator`
**Files**: All frontend components (TodoForm, TodoItem, TodoList, RegisterForm, LoginForm, etc.)
**Depends on**: TASK-062
**Description**: Replace hardcoded strings with translation keys
**Acceptance**:
- [ ] All user-facing text uses t('key') from next-intl
- [ ] No hardcoded English strings in components
- [ ] Urdu text renders correctly with proper fonts
- [ ] Placeholder text, button labels, error messages all translated

### Testing Tasks (US7)

#### TASK-066: E2E Tests - Language Switching
**Agent**: `frontend-builder`
**File**: `frontend/tests/e2e/i18n.spec.ts`
**Depends on**: TASK-063, TASK-064, TASK-065
**Description**: Test language switching functionality
**Acceptance**:
- [ ] Test: Switch to Urdu, verify UI displays in Urdu
- [ ] Test: Verify RTL layout in Urdu mode
- [ ] Test: Switch back to English, verify LTR layout
- [ ] Test: Create todo in Urdu, verify it displays correctly
- [ ] Test: Language preference persists after refresh
- [ ] All tests pass: `pnpm test:e2e`

---

## Integration & Review Tasks

#### TASK-067: Backend - Register All Routers in Main App
**Agent**: `backend-api-guardian`
**File**: `backend/app/main.py`
**Depends on**: TASK-003, TASK-009, TASK-027
**Description**: Mount auth and todos routers with proper prefixes
**Acceptance**:
- [ ] app.include_router(auth_router, prefix="/api/auth", tags=["auth"])
- [ ] app.include_router(todos_router, prefix="/api/todos", tags=["todos"])
- [ ] OpenAPI docs accessible at /docs
- [ ] All endpoints visible in Swagger UI

#### TASK-068: Backend - Setup Environment Variables
**Agent**: `backend-api-guardian`
**File**: `backend/.env.example`
**Description**: Document all required environment variables
**Acceptance**:
- [ ] DATABASE_URL (Neon PostgreSQL connection string)
- [ ] BETTER_AUTH_SECRET (min 32 chars)
- [ ] ACCESS_TOKEN_EXPIRE_MINUTES (default: 30)
- [ ] REFRESH_TOKEN_EXPIRE_DAYS (default: 7)
- [ ] CORS_ORIGINS (comma-separated, default: http://localhost:3000)
- [ ] Instructions in comments

#### TASK-069: Frontend - Setup Environment Variables
**Agent**: `frontend-builder`
**File**: `frontend/.env.local.example`
**Description**: Document frontend environment variables
**Acceptance**:
- [ ] NEXT_PUBLIC_API_URL (backend URL, default: http://localhost:8000)
- [ ] BETTER_AUTH_SECRET (same as backend)
- [ ] BETTER_AUTH_URL (frontend URL, default: http://localhost:3000)
- [ ] Instructions in comments

#### TASK-070: Create Backend pyproject.toml
**Agent**: `backend-api-guardian`
**File**: `backend/pyproject.toml`
**Description**: Define Python dependencies with uv
**Acceptance**:
- [ ] Dependencies: fastapi, uvicorn, sqlmodel, psycopg2-binary, alembic, python-jose[cryptography], passlib[bcrypt], python-dotenv
- [ ] Dev dependencies: pytest, pytest-cov, pytest-benchmark, httpx
- [ ] Python version: >=3.13
- [ ] uv sync installs all dependencies

#### TASK-071: Create Frontend package.json
**Agent**: `frontend-builder`
**File**: `frontend/package.json`
**Description**: Define Node dependencies with pnpm
**Acceptance**:
- [ ] Dependencies: next@16+, react, react-dom, typescript, tailwindcss, better-auth, axios, framer-motion, next-intl
- [ ] Dev dependencies: @types/react, @types/node, jest, @testing-library/react, @playwright/test, eslint
- [ ] Scripts: dev, build, start, test, test:e2e
- [ ] Node version: >=18
- [ ] pnpm install works

#### TASK-072: Run All Backend Tests
**Agent**: `backend-api-guardian`
**Depends on**: All backend testing tasks
**Description**: Execute full backend test suite
**Acceptance**:
- [ ] `uv run pytest -v` passes all tests
- [ ] Test coverage >= 80%: `uv run pytest --cov=app --cov-report=html`
- [ ] No failing tests
- [ ] All acceptance scenarios from spec.md verified

#### TASK-073: Run All Frontend Tests
**Agent**: `frontend-builder`
**Depends on**: All frontend testing tasks
**Description**: Execute full frontend test suite
**Acceptance**:
- [ ] `pnpm test` passes all Jest tests
- [ ] `pnpm test:e2e` passes all Playwright tests
- [ ] No failing tests
- [ ] All user stories verified through E2E tests

#### TASK-074: Performance Benchmarking
**Agent**: `backend-api-guardian`
**File**: `backend/tests/test_performance.py`
**Description**: Benchmark API endpoints against performance goals
**Acceptance**:
- [ ] Use pytest-benchmark for performance tests
- [ ] Test POST /api/todos: p95 latency < 300ms
- [ ] Test GET /api/todos: p95 latency < 300ms
- [ ] Test concurrent users: 100 concurrent requests succeed
- [ ] Frontend Lighthouse score: Performance >= 90, Accessibility >= 95

#### TASK-075: Security Audit
**Agent**: `backend-api-guardian`
**Depends on**: TASK-037
**Description**: Final security verification
**Acceptance**:
- [ ] All endpoints validate JWT
- [ ] All todo queries filter by user_id
- [ ] Password complexity enforced
- [ ] No SQL injection vulnerabilities (parameterized queries)
- [ ] No secrets in code (all in .env)
- [ ] HTTPS enforced in production
- [ ] CORS configured correctly
- [ ] Rate limiting considered (document if not implemented)

#### TASK-076: Accessibility Audit
**Agent**: `frontend-builder`
**Description**: Verify WCAG 2.1 AA compliance
**Acceptance**:
- [ ] All interactive elements keyboard accessible
- [ ] ARIA labels on all buttons, inputs, links
- [ ] Focus indicators visible (outline or ring)
- [ ] Color contrast >= 4.5:1 (use contrast checker)
- [ ] Touch targets >= 44x44px on mobile
- [ ] Screen reader tested (NVDA or VoiceOver)
- [ ] Semantic HTML (nav, main, button, etc.)

#### TASK-077: Create README Documentation
**Agent**: `spec-orchestrator`
**File**: `README.md` (root)
**Description**: Project overview and setup instructions
**Acceptance**:
- [ ] Project description and features
- [ ] Tech stack list
- [ ] Prerequisites (uv, pnpm, Neon account)
- [ ] Quick start (clone, setup backend, setup frontend, run)
- [ ] Link to specs/001-todo-full-stack-app/quickstart.md for detailed guide
- [ ] Link to constitution.md
- [ ] License information

#### TASK-078: Update Agent Context (CLAUDE.md)
**Agent**: `spec-orchestrator`
**File**: `CLAUDE.md`
**Description**: Update agent context with implementation details
**Acceptance**:
- [ ] Add backend structure: backend/app/ with routers, models, schemas
- [ ] Add frontend structure: frontend/app/, components/, hooks/, lib/
- [ ] Document key patterns: JWT extraction, user filtering, optimistic UI
- [ ] Document Skills used: API, Database, Auth, Voice, UI
- [ ] Note completed features: US1-US7

#### TASK-079: Create Prompt History Record (PHR)
**Agent**: `spec-orchestrator`
**File**: `history/prompts/001-todo-full-stack-app/4-generate-tasks.tasks.prompt.md`
**Description**: Document task generation process
**Acceptance**:
- [ ] PHR created with id: 4, stage: tasks
- [ ] Full user prompt captured
- [ ] Summary of 79 tasks generated
- [ ] Organized by user story
- [ ] Links to spec.md and plan.md

#### TASK-080: Final Spec Compliance Check
**Agent**: `spec-orchestrator`
**Depends on**: All implementation tasks
**Description**: Verify all requirements from spec.md are met
**Acceptance**:
- [ ] All 7 user stories implemented and tested
- [ ] All 28 functional requirements (FR-001 to FR-028) satisfied
- [ ] All 12 success criteria (SC-001 to SC-012) verified
- [ ] All edge cases handled
- [ ] All out-of-scope items confirmed not implemented
- [ ] All acceptance scenarios pass

---

## Task Execution Strategy

### Phase 1: Foundation (US1 - Authentication)
**Parallel Execution**: TASK-001, TASK-003, TASK-004, TASK-005, TASK-012
**Critical Path**: TASK-001 → TASK-002 → TASK-009 → TASK-021
**Estimated Duration**: Complete authentication before proceeding to US2

### Phase 2: Core Todo CRUD (US2, US3, US4)
**Parallel Execution**: US2, US3, US4 can be developed simultaneously after US1
**Critical Path**: TASK-024 → TASK-025 → TASK-027 → TASK-036
**Estimated Duration**: Core todo functionality

### Phase 3: Advanced Features (US5, US6, US7)
**Parallel Execution**: US5, US6, US7 can be developed in parallel
**Dependencies**: All depend on US1-US4 being complete
**Estimated Duration**: Voice and Urdu features

### Phase 4: Integration & Testing (TASK-067 to TASK-080)
**Sequential**: Must run after all user stories complete
**Critical**: Performance, security, accessibility audits before deployment

### Agent Assignments

- **database-architect**: TASK-001, 002, 004, 024, 025
- **backend-api-guardian**: TASK-003, 005, 009, 010, 011, 027, 028, 040, 045, 046, 067, 068, 070, 072, 074, 075
- **auth-config-specialist**: TASK-006, 007, 008, 013
- **frontend-builder**: TASK-012, 014, 015, 016, 017, 018, 019, 020, 029, 030, 031, 032, 033, 034, 035, 041, 042, 047, 048, 051, 052, 053, 054, 055, 059, 061, 063, 064, 069, 071, 073, 076
- **urdu-translator**: TASK-062, 065
- **spec-orchestrator**: TASK-077, 078, 079, 080

---

## Definition of Done

A task is considered complete when:

1. ✅ All acceptance criteria checkboxes are checked
2. ✅ Code follows TypeScript/Python type safety standards
3. ✅ Unit tests written and passing
4. ✅ Integration/E2E tests passing (where applicable)
5. ✅ Code reviewed for security (JWT validation, user filtering)
6. ✅ Accessibility verified (keyboard, ARIA, contrast)
7. ✅ Mobile responsive (320px+)
8. ✅ Error handling implemented
9. ✅ Documentation updated (if needed)
10. ✅ Constitution compliance verified

---

**Total Tasks**: 80 (including integration and review)
**Ready for Implementation**: Yes - all tasks defined with exact file paths and acceptance criteria
**Next Command**: `/sp.implement` to begin agent-driven implementation
